var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.HelperFunctions={getType:function(e){return null===e||void 0===e?""+e:"object"==typeof e||"function"==typeof e?{}.toString.call(e).match(/\[\S+\s(\w+)\]/)[1].toLowerCase():typeof e},validateParameter:function(e,t,n,r,i){if(!(r&&_.isNull(e)||i&&_.isUndefined(e))){if("string"!=typeof n){if(e instanceof n)return;throw"Parameter "+t+" does not implement expected type "+n+"."}var a=TW.SDK.HelperFunctions.getType(e);if(a!==n)throw"Expected "+n+" for parameter "+t+", received "+a+" instead."}},convertByteArrayToBuffer:function(e){this.validateParameter(e,"array","array"),e=new Int8Array(e);for(var t=new ArrayBuffer(e.length),n=new DataView(t),r=0;r<e.length;r++)n.setInt8(r,e[r]);return t},convertInt8ToBuffer:function(e){this.validateParameter(e,"content","number");var t=new ArrayBuffer(1),n=new DataView(t);return n.setInt8(0,e),t},convertInt16ToBuffer:function(e){this.validateParameter(e,"content","number");var t=new ArrayBuffer(2),n=new DataView(t);return n.setInt16(0,e),t},convertInt32ToBuffer:function(e){this.validateParameter(e,"content","number");var t=new ArrayBuffer(4),n=new DataView(t);return n.setInt32(0,e),t},combineArrayBuffers:function(e){this.validateParameter(e,"buffersArray","array");for(var t=0,n=0;n<e.length;n++)t+=e[n].byteLength;var r=new ArrayBuffer(t),i=new DataView(r),a=0;for(n=0;n<e.length;n++)for(var o=new Int8Array(e[n]),s=0;s<o.byteLength;s++)i.setInt8(a++,o[s]);return r}};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.BaseTypes={NOTHING:-1,STRING:0,NUMBER:1,BOOLEAN:2,DATETIME:3,TIMESPAN:4,INFOTABLE:5,LOCATION:6,XML:7,JSON:8,QUERY:9,IMAGE:10,HYPERLINK:11,IMAGELINK:12,PASSWORD:13,HTML:14,TEXT:15,TAGS:16,SCHEDULE:17,VARIANT:18,GUID:20,BLOB:21,INTEGER:22,LONG:23,PROPERTYNAME:50,SERVICENAME:51,EVENTNAME:52,THINGNAME:100,THINGSHAPENAME:101,THINGTEMPLATENAME:102,DATASHAPENAME:104,MASHUPNAME:105,MENUNAME:106,BASETYPENAME:107,USERNAME:108,GROUPNAME:109,CATEGORYNAME:110,STATEDEFINITIONNAME:111,STYLEDEFINITIONNAME:112,MODELTAGVOCABULARYNAME:113,DATATAGVOCABULARYNAME:114,NETWORKNAME:115,MEDIAENTITYNAME:116,APPLICATIONKEYNAME:117,LOCALIZATIONTABLENAME:118,ORGANIZATIONNAME:119,DASHBOARDNAME:120,PERSISTENCEPROVIDERPACKAGENAME:121,PERSISTENCEPROVIDERNAME:122,PROJECTNAME:123,VEC2:124,VEC3:125,VEC4:126,THINGCODE:127,fromCode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"code","number");var t=_.findKey(TW.SDK.BaseTypes,function(t){return e===t});if(_.isUndefined(t))throw"Primitive code "+e+" not supported";return t},infer:function(e){return e=e||"","string"==typeof e?this.STRING:"number"==typeof e?this.NUMBER:"boolean"==typeof e?this.BOOLEAN:"object"==typeof e?e instanceof Date?this.DATETIME:e.dataShape?this.INFOTABLE:this.JSON:void 0}};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.BlobPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=new DataView(e),n=t.getInt32(0),r=4,i=new Uint8Array(e,r,n),a=String.fromCharCode.apply(null,i);return{length:n+r,content:btoa(a)}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","string");var t=e;t=atob(e);var n=t.length+4,r=0,i=new ArrayBuffer(n),a=new DataView(i);a.setInt32(r,t.length),r+=4;for(var o=0;o<t.length;o++)a.setInt8(r++,t.charCodeAt(o));return i},getDefaultValue:function(){return""}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.BooleanPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=new DataView(e);return{length:1,content:1===t.getInt8(0)}},encode:function(e){return TW.SDK.HelperFunctions.convertInt8ToBuffer(e?1:0)},getDefaultValue:function(){return!1}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},TW.SDK.Types.DataShape=function(e){var t={};e&&e.fieldDefinitions&&(t=e.fieldDefinitions);var n={fieldDefinitions:t};return n};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},TW.SDK.Types.DataShapeHelper={addField:function(e,t,n,r,i){e&&e.fieldDefinitions&&t&&(e.fieldDefinitions[t]={name:t,aspects:i?i:{},description:n,baseType:r,ordinal:0})},getField:function(e,t){return e&&e.fieldDefinitions?e.fieldDefinitions[t]:null}};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.DateTimePrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.LongPrimitive.decode(e);return{length:8,content:new Date(t.content)}},encode:function(e){return TW.SDK.HelperFunctions.validateParameter(e,"content",Date),TW.SDK.Types.LongPrimitive.encode(e.getTime())},getDefaultValue:function(){return new Date}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},TW.SDK.Types.InfoTable=function(e){var t=new TW.SDK.Types.DataShape,n=[];e&&(e.dataShape&&(t=e.dataShape),e.rows&&(n=e.rows));var r={rows:n,dataShape:t};return r};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},TW.SDK.Types.InfoTableHelper={addRow:function(e,t){t&&e&&e.rows&&e.rows.push(t)},getRow:function(e,t){return e&&e.rows&&t>=0&&t<e.rows.length?e.rows[t]:null},getRowCount:function(e){return e&&e.rows?e.rows.length:-1}};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){var e=function(e,t){var n=new DataView(e),r=0,i=TW.SDK.Types.StringPrimitive.decode(e),a=i.content;r+=i.length;var o=n.getInt8(r++),s=TW.SDK.Primitives.fromCode(o).decode(e.slice(r)),T=s.content;return r+=s.length,t[a]=T,r},t=function(t,n){var r=new DataView(t),i=0,a=TW.SDK.Types.StringPrimitive.decode(t),o=a.content;i+=a.length;var s=TW.SDK.Types.StringPrimitive.decode(t.slice(i)),T=s.content;i+=s.length;var u=TW.SDK.BaseTypes.fromCode(r.getInt8(i++)),c=r.getInt16(i),f={};i+=2;for(var p=0;p<c;p++)i+=e(t.slice(i),f);return TW.SDK.Types.DataShapeHelper.addField(n,o,T,u,f),i},n=function(e,t,n){var r=new DataView(e),i=0,a=_.keys(t),o=r.getInt16(i);i+=2;for(var s=0;s<o;s++){var T=r.getInt8(i++),u=TW.SDK.Primitives.fromCode(T).decode(e.slice(i)),c=u.content;i+=u.length,null!==c&&(n[a[s]]=c)}return i},r=function(e){var t=[];return t.push(TW.SDK.Types.StringPrimitive.encode(e.name)),t.push(TW.SDK.Types.StringPrimitive.encode(e.description)),t.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(TW.SDK.BaseTypes[e.baseType])),t.push(TW.SDK.HelperFunctions.convertInt16ToBuffer(_.size(e.aspects))),_.each(e.aspects,function(e,n){var r=TW.SDK.BaseTypes.infer(e);t.push(TW.SDK.Types.StringPrimitive.encode(n)),t.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(r)),t.push(TW.SDK.Primitives.fromCode(r).encode(e))}),t},i=function(e,t){var n=[];return n.push(TW.SDK.HelperFunctions.convertInt16ToBuffer(_.size(e))),_.each(e,function(e){var r,i=t[e.name];_.isUndefined(i)||_.isNull(i)?(r=TW.SDK.BaseTypes.NOTHING,n.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(r)),n.push(TW.SDK.Primitives.fromCode(r).encode())):(r=TW.SDK.BaseTypes[e.baseType],n.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(r)),n.push(TW.SDK.Primitives.fromCode(r).encode(i)))}),n};TW.SDK.Types.InfoTablePrimitive={},TW.SDK.Types.InfoTablePrimitive.decodeView=function(e,r,i){for(var a=new TW.SDK.Types.InfoTable,o=e.getInt8(r++);1===o;)r+=t(i.slice(r),a.dataShape),o=e.getInt8(r++);for(var s=e.getInt8(r++);1===s;){var T={};r+=n(i.slice(r),a.dataShape.fieldDefinitions,T),TW.SDK.Types.InfoTableHelper.addRow(a,T),s=e.getInt8(r++)}return{offset:r,result:a}},TW.SDK.Types.InfoTablePrimitive.decode=function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=new DataView(e),n=0,r=TW.SDK.Types.InfoTablePrimitive.decodeView(t,n,e);n=r.offset;var i=r.result;return{content:i,length:n}},TW.SDK.Types.InfoTablePrimitive.encode=function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[],n=e.dataShape.fieldDefinitions,a=e.rows,o=_.sortBy(n,"ordinal");return _.each(o,function(e){t.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(1)),t.push(r(e))}),t.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(0)),_.each(a,function(e){t.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(1)),t.push(i(o,e))}),t.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(0)),t=_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},TW.SDK.Types.InfoTablePrimitive.getDefaultValue=function(){return new TW.SDK.Types.InfoTable}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.IntegerPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=new DataView(e);return{length:4,content:t.getInt32(0)}},encode:function(e){return TW.SDK.HelperFunctions.validateParameter(e,"content","number"),TW.SDK.HelperFunctions.convertInt32ToBuffer(e)},getDefaultValue:function(){return 0}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.JSONPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.StringPrimitive.decode(e);return{length:t.length,content:JSON.parse(t.content)}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=JSON.stringify(e);return TW.SDK.Types.StringPrimitive.encode(t)},getDefaultValue:function(){return{}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.LocationPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.NumberPrimitive.decode(e.slice(0,8)),n=TW.SDK.Types.NumberPrimitive.decode(e.slice(8,16)),r=TW.SDK.Types.NumberPrimitive.decode(e.slice(16));return{length:24,content:{latitude:n.content,longitude:t.content,elevation:r.content}}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[];return t.push(TW.SDK.Types.NumberPrimitive.encode(e.longitude)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.latitude)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.elevation)),_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},getDefaultValue:function(){return{latitude:0,longitude:0,elevation:0}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){var e=4294967296;TW.SDK.Types.LongPrimitive={decode:function(t){TW.SDK.HelperFunctions.validateParameter(t,"data",ArrayBuffer);var n=new DataView(t),r=n.getInt32(0);return r*=e,r+=n.getUint32(4),{length:8,content:r}},encode:function(t){TW.SDK.HelperFunctions.validateParameter(t,"content","number");var n=new ArrayBuffer(8),r=new DataView(n),i=t/e;return i<0&&(i=Math.floor(i)),r.setInt32(0,~~i),r.setUint32(4,4294967295&t),n},getDefaultValue:function(){return 0}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.NothingPrimitive={encode:function(e){return new ArrayBuffer(0)},decode:function(e){return{length:0,content:null}},getDefaultValue:function(){return null}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.NumberPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=new DataView(e);return{length:8,content:t.getFloat64(0)}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","number");var t=new ArrayBuffer(8),n=new DataView(t);return n.setFloat64(0,e),t},getDefaultValue:function(){return 0}}}();var TW=TW||{};TW.SDK=TW.SDK||{},function(){var e=TW.SDK.BaseTypes;TW.SDK.Primitives={fromCode:function(t){if(TW.SDK.HelperFunctions.validateParameter(t,"code","number"),t===e.NOTHING)return TW.SDK.Types.NothingPrimitive;if(t===e.STRING||t===e.XML||t===e.HYPERLINK||t===e.PASSWORD||t===e.HTML||t===e.TEXT||t===e.GUID||t>=e.PROPERTYNAME&&t<=e.EVENTNAME||t>=e.THINGNAME&&t<=e.PROJECTNAME)return TW.SDK.Types.StringPrimitive;if(t===e.JSON||t===e.QUERY)return TW.SDK.Types.JSONPrimitive;if(t===e.BOOLEAN)return TW.SDK.Types.BooleanPrimitive;if(t===e.NUMBER)return TW.SDK.Types.NumberPrimitive;if(t===e.INTEGER)return TW.SDK.Types.IntegerPrimitive;if(t===e.LONG)return TW.SDK.Types.LongPrimitive;if(t===e.DATETIME)return TW.SDK.Types.DateTimePrimitive;if(t===e.LOCATION)return TW.SDK.Types.LocationPrimitive;if(t===e.BLOB||t===e.IMAGE)return TW.SDK.Types.BlobPrimitive;if(t===e.INFOTABLE)return TW.SDK.Types.InfoTablePrimitive;if(t===e.TIMESPAN)return TW.SDK.Types.TimespanPrimitive;if(t===e.TAGS)return TW.SDK.Types.TagCollectionPrimitive;if(t===e.VARIANT)return TW.SDK.Types.VariantPrimitive;if(t===e.VEC2)return TW.SDK.Types.Vec2Primitive;if(t===e.VEC3)return TW.SDK.Types.Vec3Primitive;if(t===e.VEC4)return TW.SDK.Types.Vec4Primitive;if(t===e.THINGCODE)return TW.SDK.Types.ThingCodePrimitive;var n=e.fromCode(t);throw n?"Primitive code "+n+" not supported":"Primitive code ID "+t+" not supported"}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.StringPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=new DataView(e),n=t.getInt8(0),r=1;128&n&&(n=t.getUint32(0)-2147483648,r=4);var i=new Uint8Array(e,r,n),a="";return a=String.fromCharCode.apply(null,i),{length:n+r,content:decodeURIComponent(escape(a))}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","string");var t=e;t=unescape(encodeURIComponent(t));var n=t.length,r=n,i=0;if(t.length>127){if(r+=4,!(n<2147483648))throw"String too long to be encoded, length is "+n;n=2147483648|n}else r+=1;var a=new ArrayBuffer(r),o=new DataView(a);t.length>127?(o.setInt32(i,n),i+=4):o.setInt8(i++,n);for(var s=0;s<t.length;s++)o.setInt8(i++,t.charCodeAt(s));return a},getDefaultValue:function(){return""}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.TagCollectionPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.StringPrimitive.decode(e),n=t.content.split(";"),r=[];return _.each(n,function(e){var t=e.split(":");r.push({vocabulary:t[0],vocabularyTerm:t[1]})}),{length:t.length,content:r}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","array");var t="",n=_.last(e);return _.each(e,function(e){var r=e.vocabulary||"",i=e.vocabularyTerm||"";t+=r+":"+i,e!==n&&(t+=";")}),TW.SDK.Types.StringPrimitive.encode(t)},getDefaultValue:function(){return[]}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.ThingCodePrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.IntegerPrimitive.decode(e.slice(0,4)),n=TW.SDK.Types.LongPrimitive.decode(e.slice(4));return{length:12,content:{domainId:t.content,instanceId:n.content}}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[];return t.push(TW.SDK.Types.IntegerPrimitive.encode(e.domainId)),t.push(TW.SDK.Types.LongPrimitive.encode(e.instanceId)),_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},getDefaultValue:function(){return{domainId:0,instanceId:0}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.TimespanPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.LongPrimitive.decode(e.slice(0,8)),n=TW.SDK.Types.LongPrimitive.decode(e.slice(8,16)),r=TW.SDK.Types.StringPrimitive.decode(e.slice(16));return{length:t.length+n.length+r.length,content:{start:t.content,end:n.content,period:r.content}}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[];return t.push(TW.SDK.Types.LongPrimitive.encode(e.start)),t.push(TW.SDK.Types.LongPrimitive.encode(e.end)),t.push(TW.SDK.Types.StringPrimitive.encode(e.period)),_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},getDefaultValue:function(){return{start:0,end:0,period:"00:00:00:00:01:00"}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.VariantPrimitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=new DataView(e),n=t.getInt8(0),r=TW.SDK.Primitives.fromCode(n).decode(e.slice(1));return{length:r.length+1,content:{baseType:TW.SDK.BaseTypes.fromCode(n),value:r.content}}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[],n=TW.SDK.BaseTypes[e.baseType];return t.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(n)),t.push(TW.SDK.Primitives.fromCode(n).encode(e.value)),_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},getDefaultValue:function(){return{baseType:"STRING",value:""}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.Vec2Primitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.NumberPrimitive.decode(e.slice(0,8)),n=TW.SDK.Types.NumberPrimitive.decode(e.slice(8));return{length:16,content:{x:t.content,y:n.content}}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[];return t.push(TW.SDK.Types.NumberPrimitive.encode(e.x)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.y)),_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},getDefaultValue:function(){return{x:0,y:0}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.Vec3Primitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.NumberPrimitive.decode(e.slice(0,8)),n=TW.SDK.Types.NumberPrimitive.decode(e.slice(8,16)),r=TW.SDK.Types.NumberPrimitive.decode(e.slice(16));return{length:24,content:{x:t.content,y:n.content,z:r.content}}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[];return t.push(TW.SDK.Types.NumberPrimitive.encode(e.x)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.y)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.z)),_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},getDefaultValue:function(){return{x:0,y:0,z:0}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Types=TW.SDK.Types||{},function(){TW.SDK.Types.Vec4Primitive={decode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"data",ArrayBuffer);var t=TW.SDK.Types.NumberPrimitive.decode(e.slice(0,8)),n=TW.SDK.Types.NumberPrimitive.decode(e.slice(8,16)),r=TW.SDK.Types.NumberPrimitive.decode(e.slice(16,24)),i=TW.SDK.Types.NumberPrimitive.decode(e.slice(24));return{length:32,content:{x:t.content,y:n.content,z:r.content,w:i.content}}},encode:function(e){TW.SDK.HelperFunctions.validateParameter(e,"content","object");var t=[];return t.push(TW.SDK.Types.NumberPrimitive.encode(e.x)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.y)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.z)),t.push(TW.SDK.Types.NumberPrimitive.encode(e.w)),_.flatten(t),TW.SDK.HelperFunctions.combineArrayBuffers(t)},getDefaultValue:function(){return{x:0,y:0,z:0,w:1}}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Characteristics={Unknown:-1,Custom:0,Properties:1,Services:2,Events:3,PropertiesVTQ:4};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.ContextTypes={UNKNOWN:0,GET:1,PUT:2,POST:3,DELETE:4,BINDREQUEST:10,UNBINDREQUEST:11,AUTHREQUEST:20,CLEARAUTHREQUEST:21,RESPONSE:64};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.EntityTypes={Unknown:-1,Things:10,ThingShapes:11,ThingTemplates:12,ThingPackages:13,Networks:14,DataShapes:15,ModelTags:20,DataTags:21,Mashups:30,Widgets:31,StyleDefinitions:32,StateDefinitions:33,Menus:34,MediaEntities:35,LocalizationTables:36,Dashboards:39,Logs:40,Users:50,Groups:51,Organizations:52,ApplicationKeys:53,DirectoryServices:54,Authenticators:55,Resources:60,ScriptFunctionLibraries:61,ExtensionPackages:70,Subsystems:80,PersistenceProviderPackages:90,PersistenceProviders:100,Projects:110};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.BaseContext=function(e){var t=1,n=TW.SDK.ContextTypes.UNKNOWN,r=0,i=-1,a=-1,o=0;e&&(_.isUndefined(e.requestId)||(r=e.requestId),_.isUndefined(e.endpointId)||(i=e.endpointId),_.isUndefined(e.sessionId)||(a=e.sessionId),e.contextType&&(n=e.contextType));var s={getVersion:function(){return t},getContextType:function(){return n},getRequestId:function(){return r},getEndpointId:function(){return i},getSessionId:function(){return a},isMultipart:function(){return o},getBaseSize:function(){return 15},readBaseContext:function(e){t=e.getInt8(0),n=e.getInt8(1),r=e.getInt32(2),i=e.getInt32(6),a=e.getInt32(10),o=e.getInt8(14)},writeBaseContext:function(e){e.setInt8(0,t),e.setInt8(1,n),e.setInt32(2,r),e.setInt32(6,i),e.setInt32(10,a),e.setInt8(14,o)},readUtf8:function(e){for(var t=e.buffer,n=t.getInt8(e.offset++),r="",i=0;i<n;i++){var a=String.fromCharCode(t.getInt8(e.offset++));r+=a}return r},writeUtf8:function(e,t,n){t.setInt8(n++,e.length);for(var r=0;r<e.length;r++)t.setInt8(n++,e[r].charCodeAt(0));return n},fromBinary:function(e){var t=new DataView(e);this.readBaseContext(t)},toBinary:function(){var e=this.getBaseSize(),t=new ArrayBuffer(e),n=new DataView(t,0);return this.writeBaseContext(n),t},isApiRequest:function(){return n>=TW.SDK.ContextTypes.GET&&n<=TW.SDK.ContextTypes.DELETE},isBindRequest:function(){return n===TW.SDK.ContextTypes.BINDREQUEST||n===TW.SDK.ContextTypes.UNBINDREQUEST},isAuthRequest:function(){return n===TW.SDK.ContextTypes.AUTHREQUEST},isClearAuthRequest:function(){return n===TW.SDK.ContextTypes.CLEARAUTHREQUEST},isRequest:function(){return n>=TW.SDK.ContextTypes.GET&&n<=TW.SDK.ContextTypes.CLEARAUTHREQUEST},isResponse:function(){return n!==TW.SDK.ContextTypes.UNKNOWN&&!this.isRequest()}};return s};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.APIContext=function(e){var t=TW.SDK.EntityTypes.UNKNOWN,n="",r=TW.SDK.Characteristics.UNKNOWN,i="",a={},o=new TW.SDK.Types.InfoTable;e&&(e.entityTypeCode&&(t=e.entityTypeCode),e.entityName&&(n=e.entityName),e.characteristic&&(r=e.characteristic),e.target&&(i=e.target),e.headers&&(a=e.headers),e.parameters&&(o=e.parameters));var s=_.extend({},new TW.SDK.BaseContext(e),{getEntityTypeCode:function(){return t},getEntityName:function(){return n},getCharacteristic:function(){return r},getTarget:function(){return i},getHeaders:function(){return a},getParameters:function(){return o},fromBinary:function(e){var s=new DataView(e);this.readBaseContext(s);var T=this.getBaseSize();t=s.getInt8(T++);var u={buffer:s,offset:T};n=this.readUtf8(u),r=s.getInt8(u.offset++),i=this.readUtf8(u);for(var c=s.getInt8(u.offset++),f=0;f<c;f++){var p=this.readUtf8(u),d=this.readUtf8(u);a[p]=d}var S=s.getInt8(u.offset++);if(S===TW.SDK.BaseTypes.INFOTABLE){var l=TW.SDK.Types.InfoTablePrimitive.decodeView(s,u.offset,e);o=l.result}},toBinary:function(){var e=this.getBaseSize()+4;e+=n.length+1,e+=i.length+1;var s=_.size(a);_.each(a,function(t,n){e+=n.length+1,e+=t.length+1});var T=new ArrayBuffer(e),u=new DataView(T,0);this.writeBaseContext(u);var c=this.getBaseSize();u.setInt8(c++,t),c=this.writeUtf8(n,u,c),u.setInt8(c++,r),c=this.writeUtf8(i,u,c),u.setInt8(c++,s);var f=this;_.each(a,function(e,t){c=f.writeUtf8(t,u,c),c=f.writeUtf8(e,u,c)}),u.setInt8(c++,TW.SDK.BaseTypes.INFOTABLE);var p=TW.SDK.Types.InfoTablePrimitive.encode(o);return TW.SDK.HelperFunctions.combineArrayBuffers([T,p])}});return s};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.AuthContext=function(e){var t={};e&&e.securityClaims&&(t=e.securityClaims);var n=_.extend({contextType:TW.SDK.ContextTypes.AUTHREQUEST},e),r=_.extend({},new TW.SDK.BaseContext(n),{getSecurityClaims:function(){return t},fromBinary:function(e){var n=new DataView(e);this.readBaseContext(n);for(var r=this.getBaseSize(),i=n.getInt8(r++),a={buffer:n,offset:r},o=0;o<i;o++){var s=this.readUtf8(a),T=this.readUtf8(a);t[s]=T}},toBinary:function(){var e=this.getBaseSize()+1,n=_.size(t);_.each(t,function(t,n){e+=n.length+1,e+=t.length+1});var r=new ArrayBuffer(e),i=new DataView(r,0);this.writeBaseContext(i);var a=15;i.setInt8(a++,n);var o=this;return _.each(t,function(e,t){a=o.writeUtf8(t,i,a),a=o.writeUtf8(e,i,a)}),r}});return r};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.BindContext=function(e){var t=[],n="",r="";e&&(e.gatewayName&&(n=e.gatewayName),e.gatewayType&&(r=e.gatewayType),e.names&&(t=e.names));var i=_.extend({contextType:TW.SDK.ContextTypes.BINDREQUEST},e),a=_.extend({},new TW.SDK.BaseContext(i),{getNames:function(){return t},getGatewayName:function(){return n},getGatewayType:function(){return r},fromBinary:function(e){var i=new DataView(e);this.readBaseContext(i);var a=this.getBaseSize(),o=i.getInt8(a++),s={buffer:i,offset:a};o&&(n=this.readUtf8(s),r=this.readUtf8(s));var T=i.getInt16(s.offset);s.offset+=2;for(var u=0;u<T;u++){var c=this.readUtf8(s);t.push(c)}},toBinary:function(){var e=this.getBaseSize()+3;n&&r&&(e+=n.length+1,e+=r.length+1);var i,a=t.length;for(i=0;i<a;i++)e+=t[i].length+1;var o=new ArrayBuffer(e),s=new DataView(o,0);this.writeBaseContext(s);var T=this.getBaseSize();for(n&&r?(s.setInt8(T++,1),T=this.writeUtf8(n,s,T),T=this.writeUtf8(r,s,T)):s.setInt8(T++,0),s.setInt16(T,a),T+=2,i=0;i<a;i++)T=this.writeUtf8(t[i],s,T);return o}});return a};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.ResponseContext=function(e){var t=null,n="",r=TW.SDK.BaseTypes.NOTHING;e&&(e.resultMessage&&(n=e.resultMessage),e.result&&(t=e.result),e.resultType&&(r=e.resultType));var i=_.extend({contextType:TW.SDK.ContextTypes.RESPONSE},e),a=_.extend({},new TW.SDK.BaseContext(i),{getResult:function(){return t},getResultType:function(){return r},getResultMessage:function(){return n},getStatusCode:function(){return TW.SDK.StatusCodes.unencode(this.getContextType())},fromBinary:function(e){var i=new DataView(e);this.readBaseContext(i);var a=this.getBaseSize(),o=TW.SDK.Types.StringPrimitive.decode(e.slice(a));n=o.content,a+=o.length,r=i.getInt8(a++),t=TW.SDK.Primitives.fromCode(r).decode(e.slice(a))},toBinary:function(){var e=[];e.push(new ArrayBuffer(this.getBaseSize())),e.push(TW.SDK.Types.StringPrimitive.encode(n)),e.push(TW.SDK.HelperFunctions.convertInt8ToBuffer(r)),e.push(TW.SDK.Primitives.fromCode(r).encode(t));var i=TW.SDK.HelperFunctions.combineArrayBuffers(e),a=new DataView(i,0);return this.writeBaseContext(a),i}});return a};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.StatusCodes=function(){var e=[200,201,202,204,304,400,401,403,404,405,406,408,409,500,501,503,504,505,701,703,704],t=[64,65,66,68,100,128,129,131,132,133,134,136,137,160,161,163,164,165,225,227,228],n=TW.SDK.HelperFunctions.validateParameter;return{unencode:function(r){n(r,"code","number");var i=t.indexOf(r);if(i<0)throw"Invalid status code encoding: "+r;return e[i]},encode:function(r){n(r,"code","number");var i=e.indexOf(r);if(i<0)throw"Status code not supported by transport: "+r;return t[i]}}}();var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Channel=function(e){var t=function(e,t,n){TW.SDK.HelperFunctions.validateParameter(t,"config.host","string"),TW.SDK.HelperFunctions.validateParameter(n,"config.port","number"),TW.SDK.HelperFunctions.validateParameter(e,"config.ssl","boolean",!0,!0),(_.isNull(e)||_.isUndefined(e))&&(e=!0);var r=e?"wss":"ws";return r+"://"+t+":"+n+"/Thingworx/WS"},n=t(e.ssl,e.host,e.port),r=e.reconnect?e.reconnect:5,i=null,a={open:[],close:[],message:[]},o={},s={},T={},u=null,c=1e4,f=0,p=TW.SDK.HelperFunctions.validateParameter,d=function(e,t){var n=function(){D.connect(t)};setTimeout(n,1e3*e)},S=function(){if(null!==u&&D.isConnected()){var e=new TW.SDK.APIContext({requestId:-1,endpointId:u.endpointID,sessionId:u.sessionID,contextType:TW.SDK.ContextTypes.GET});D.send(e,_.noop,_.noop)}setTimeout(S,c)},l=function(e,t){var n=a[e];if(_.isUndefined(n))throw'Cannot trigger invalid event "'+e+'".';n=n.slice(),_.each(n,function(e){t?e(t):e()})},D={isConnected:function(){return null!==i&&i.readyState===WebSocket.OPEN},isClosed:function(){return null===i||i.readyState===WebSocket.CLOSED},connect:function(e){p(e,"callback","function",!0,!0);var t=!1,a=e||_.noop,c=function(e){f=0,t||(t=!0,a(!0)),l("open")},S=function(n){t?d(r,e):(t=!0,a(!1)),o={},l("close")},D=function(e){var t=TW.SDK.ContextFactory(e.data),n=t.getRequestId();if(l("message",t),null===u&&t.getSessionId()!==-1&&(u={endpointID:t.getEndpointId(),sessionID:t.getSessionId()}),t.isResponse()){var r,i=o[n];t.getStatusCode()<300?(r=s[n],delete o[n],delete s[n],delete T[n],r&&r({request:i,response:t})):(r=T[n],delete o[n],delete s[n],delete T[n],r&&r({request:i,response:t}))}},v=function(e){};i=new WebSocket(n),i.addEventListener("close",S),i.addEventListener("error",v),i.binaryType="arraybuffer",i.addEventListener("open",c),i.addEventListener("message",D)},send:function(e,t,n){p(e,"message","object"),p(t,"success","function",!0,!0),p(n,"error","function",!0,!0);var r=e.getRequestId();e.isRequest()&&(o[r]=e),s[r]=t,T[r]=n,i.send(e.toBinary())},startPseudoPing:function(e){e&&(c=e),setTimeout(S,c)},getURL:function(){return n},getProtocolContext:function(){},addEventListener:function(e,t){if(p(e,"event","string"),p(t,"callback","function"),!a[e])throw'Cannot add listener to invalid event "'+e+'".';a[e].push(t)},removeEventListener:function(e,t){if(p(e,"event","string"),p(t,"callback","function"),_.isUndefined(a[e]))throw'Cannot remove listener from invalid event "'+e+'".';var n=a[e].indexOf(t);n>-1&&a[e].splice(n,1)},hasEventListener:function(e,t){return p(e,"event","string"),p(t,"callback","function",!0,!0),t?a[e].indexOf(t)>-1:a[e].length>0},getNextRequestID:function(){return f++}};return D};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.Client=function(e){var t="",n="",r="",i=!0,a=!1,o=1e4,s="",T="",u={},c=null,f=-1,p=-1,d={};if(e&&(t=e.host,n=e.port,r=e.appKey,i=e.ssl,e.pingTimeout&&(o=e.pingTimeout),s=e.gatewayName,T=e.gatewayType,s&&T)){var S=new TW.SDK.VirtualThing({name:s});d[s]=S}var l=function(e){if(e.isRequest()){var t;try{if(e.isApiRequest()){var n=new TW.SDK.Types.InfoTable,r=d[e.getEntityName()];if(r)switch(e.getCharacteristic()){case TW.SDK.Characteristics.Properties:e.getContextType()===TW.SDK.ContextTypes.GET&&(n=r.readProperty({}));break;case TW.SDK.Characteristics.Services:e.getContextType()===TW.SDK.ContextTypes.POST&&(n=r.invokeService(e.getTarget(),e.getParameters()))}t=new TW.SDK.ResponseContext({requestId:e.getRequestId(),endpointId:e.getEndpointId(),sessionId:e.getSessionId(),result:n}),c.send(t,function(e){},function(e){})}}catch(i){t=new TW.SDK.ResponseContext({requestId:e.getRequestId(),endpointId:e.getEndpointId(),sessionId:e.getSessionId(),contextType:TW.SDK.StatusCodes.encode(500),result:TW.SDK.Types.NothingPrimitive.getDefaultValue(),resultType:TW.SDK.BaseTypes.NOTHING,resultMessage:i.toString()}),c.send(t)}}},D={connect:function(){var e={host:t,port:n,ssl:i};c=new TW.SDK.Channel(e),c.addEventListener("close",function(){_.each(u.disconnect,function(e){e()})}),c.addEventListener("message",l);var o=function(e){if(e){var t={requestId:c.getNextRequestID(),securityClaims:{appKey:r}},n=new TW.SDK.AuthContext(t);c.send(n,function(e){f=e.response.getEndpointId(),p=e.response.getSessionId(),a=!0,c.startPseudoPing(),_.each(u.connect,function(e){e()})},function(e){a=!1})}};c.connect(o)},disconnect:function(){},isConnected:function(){return a},bind:function(e){var t=[];_.isArray(e)&&_.each(e,function(e){t.push(e.getName())}),s&&t.push(s);var n={requestId:c.getNextRequestID(),sessionId:p,endpointId:f,gatewayName:s,gatewayType:T,names:t},r=new TW.SDK.BindContext(n),i=u.bind;c.send(r,function(t){_.isArray(e)&&_.each(e,function(e){d[e.getName()]||(d[e.getName()]=e)}),i&&_.each(i.slice(),function(e){e()})},function(e){})},unbind:function(e){_.isArray(e)&&_.each(e,function(e){d[e.getName()]=void 0})},invokeService:function(e,t){var n={requestId:c.getNextRequestID(),sessionId:p,endpointId:f,contextType:TW.SDK.ContextTypes.POST,entityTypeCode:TW.SDK.EntityTypes.Things,entityName:e.entityName,characteristic:TW.SDK.Characteristics.Services,target:e.target,parameters:e.parameters},r=new TW.SDK.APIContext(n);c.send(r,function(e){t&&t(null,e.response.getResult())},function(e){t&&t(e,null)})},readProperty:function(e,t){var n={requestId:c.getNextRequestID(),sessionId:p,endpointId:f,contextType:TW.SDK.ContextTypes.GET,entityTypeCode:TW.SDK.EntityTypes.Things,entityName:e.entityName,characteristic:TW.SDK.Characteristics.Properties,target:e.property},r=new TW.SDK.APIContext(n);c.send(r,function(e){t&&t(null,e.response.getResult());
},function(e){t&&t(e,null)})},writeProperty:function(e){},fireEvent:function(e){},on:function(e,t){u[e]=u[e]||[],u[e].push(t)},getThing:function(e){return d[e]},getGatewayName:function(){return s},getGatewayType:function(){return T},getApplicationKey:function(){return r},setApplicationKey:function(e){TW.SDK.HelperFunctions.validateParameter(e,"key","string"),r=e}};return D};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.ContextFactory=function(e){var t,n=new DataView(e),r=n.getInt8(1);switch(r){case TW.SDK.ContextTypes.RESPONSE:return t=new TW.SDK.ResponseContext,t.fromBinary(e),t;case TW.SDK.ContextTypes.AUTHREQUEST:return t=new TW.SDK.AuthContext,t.fromBinary(e),t;case TW.SDK.ContextTypes.BINDREQUEST:return t=new TW.SDK.BindContext,t.fromBinary(e),t;case TW.SDK.ContextTypes.GET:case TW.SDK.ContextTypes.PUT:case TW.SDK.ContextTypes.POST:case TW.SDK.ContextTypes.DELETE:return t=new TW.SDK.APIContext,t.fromBinary(e),t;default:return t=new TW.SDK.BaseContext}};var TW=TW||{};TW.SDK=TW.SDK||{},TW.SDK.VirtualThing=function(e){var t="",n={};e&&(t=e.name);var r={getName:function(){return t},addPropertyDefinition:function(e){},addServiceDefinition:function(e){},addEventDefinition:function(e){},invokeService:function(e,t){if(this[e])return this[e](t.rows[0])},readProperty:function(e){},writeProperty:function(e,t){},fireEvent:function(e){},HandleSubscribedEvent:function(e){n[e.eventName]&&n[e.eventName](e)},on:function(e,t){n[e]=t},getEventListeners:function(e){return n[e]}};return r};var TW=TW||{};TW.SubscriptionManager=function(e){var t=[],n={},r=null,i=!1,a=null,o=null,s="PersistentSession"+uuid.v4(),T="HandleSubscribedEvent";TW.SDK.HelperFunctions.validateParameter(e,"config","object");var u=function(e){var t=["sourceType","source","sourceProperty","eventName"],n=_.difference(_.keys(e),t);if(n.length>0)throw"eventDescriptor contains invalid keys: "+n;var r=_.omit(_.keys(e),t);if(r.length>0)throw"eventDescriptor is missing the required keys: "+r;_.each(e,function(e,t){TW.SDK.HelperFunctions.validateParameter(e,"eventDescriptor."+t,"string","sourceProperty"===t)})},c=function(e){var t="";return t+=e.sourceType?e.sourceType+":":"Things:",t+=e.source+":",t+=e.sourceProperty?e.sourceProperty+"."+e.eventName:e.eventName},f=function(e,t){var n={entityName:s,target:"AddDynamicRemoteSubscription",parameters:{rows:[{thingName:e.source,eventName:e.eventName,propertyName:e.sourceProperty||null,serviceName:T}],dataShape:{fieldDefinitions:{thingName:{name:"thingName",description:"",ordinal:0,baseType:"THINGNAME",aspects:{}},eventName:{name:"eventName",description:"",ordinal:1,baseType:"STRING",aspects:{}},propertyName:{name:"propertyName",description:"",ordinal:2,baseType:"STRING",aspects:{}},serviceName:{name:"serviceName",description:"",ordinal:3,baseType:"STRING",aspects:{}}}}}};a.invokeService(n,t)},p=function(e,t){var n={entityName:s,target:"RemoveDynamicRemoteSubscription",parameters:{rows:[{thingName:e.source,eventName:e.eventName,propertyName:e.sourceProperty||null}],dataShape:{fieldDefinitions:{thingName:{name:"thingName",description:"",ordinal:0,baseType:"THINGNAME",aspects:{}},eventName:{name:"eventName",description:"",ordinal:1,baseType:"STRING",aspects:{}},propertyName:{name:"propertyName",description:"",ordinal:2,baseType:"STRING",aspects:{}},serviceName:{name:"serviceName",description:"",ordinal:3,baseType:"STRING",aspects:{}}}}}};a.invokeService(n,t)},d=function(){a.bind()},S=function(e){var t=c(e),r=n[t].slice();_.each(r,function(t){t(e)})},l=function(){_.each(t,function(e){var t=function(t,n){if(t)throw"Could not restore subscription on "+c(e)+": "+t.response.getResultMessage()};i&&r.on(e.eventName,S),f(e,t)}),i=!1},D=function(){try{o(a.setApplicationKey)}catch(e){}};if(e.client){if(TW.SDK.HelperFunctions.validateParameter(e.client,"config.client","object"),TW.SDK.HelperFunctions.validateParameter(e.thingName,"config.thingName","string",!0,!0),TW.SDK.HelperFunctions.validateParameter(e.eventHandlerName,"config.eventHandlerName","string",!0,!0),a=e.client,e.eventHandlerName&&(T=e.eventHandlerName),e.thingName&&(r=a.getThing(e.thingName),!r))throw"thingName must refer to a bound VirtualThing on the provided Client instance.";a.on("connect",d),a.on("bind",l),a.isConnected()?l():a.connect()}else{TW.SDK.HelperFunctions.validateParameter(e.host,"config.host","string"),TW.SDK.HelperFunctions.validateParameter(e.port,"config.port","number"),TW.SDK.HelperFunctions.validateParameter(e.ssl,"config.ssl","boolean"),TW.SDK.HelperFunctions.validateParameter(e.gatewayType,"config.gatewayType","string",!0,!0),TW.SDK.HelperFunctions.validateParameter(e.authTokenFunction,"config.authTokenFunction","function",!0,!0),TW.SDK.HelperFunctions.validateParameter(e.appKey,"config.appKey","string",!0,!0);var v=e.host,W=e.port,y=e.ssl,K=e.gatewayType||"SDKGateway";if(!e.authTokenFunction&&!e.appKey)throw"At least one of appKey or authTokenFunction must be specified.";o=e.authTokenFunction;var m=function(e){if(a=new TW.SDK.Client({host:v,port:W,ssl:y,appKey:e,gatewayName:s,gatewayType:K}),o&&a.on("disconnect",D),r||(r=a.getThing(a.getGatewayName())),!r)throw"Provided Client must be created with gatewayName and gatewayType specified.";a.on("connect",d),a.on("bind",l),a.isConnected()?l():a.connect()};o?(o(m),i=!0):m(e.appKey)}return{subscribe:function(e,i,o,s){TW.SDK.HelperFunctions.validateParameter(e,"eventDescriptor","object"),TW.SDK.HelperFunctions.validateParameter(i,"eventHandler","function"),TW.SDK.HelperFunctions.validateParameter(o,"successHandler","function",!0,!0),TW.SDK.HelperFunctions.validateParameter(s,"errorHandler","function",!0,!0),u(e);var T=c(e);if(n[T])return n[T].push(i),void("function"==typeof o&&o());var p=function(a,u){a?"function"==typeof s&&s(a.response):(t.push(e),n[T]=[i],"function"==typeof o&&o(),r&&r.on(e.eventName,S))};a&&a.isConnected()?f(e,p):p(null,!0)},unsubscribe:function(e,r,i,o){TW.SDK.HelperFunctions.validateParameter(e,"eventDescriptor","object"),TW.SDK.HelperFunctions.validateParameter(i,"successHandler","function",!0,!0),TW.SDK.HelperFunctions.validateParameter(o,"errorHandler","function",!0,!0),u(e);var s=c(e),T=n[s];if(_.isUndefined(T))return void("function"==typeof o&&o("Event has not been subscribed to."));var f=T.indexOf(r);if(f===-1)return void("function"==typeof o&&o("Handler not subscribed to requested event."));if(T.splice(f,1),0===T.length){var d=function(a,u){if(a)T.push(r),"function"==typeof o&&o(a.response);else{delete n[s];var c=_.findIndex(t,function(t){var n=!0;return Object.keys(e).forEach(function(r){t[r]!==e[r]&&(n=!1)}),n});t.splice(c,1),"function"==typeof i&&i()}};a&&a.isConnected()?p(e,d):d(null,!0)}else"function"==typeof i&&i()},getClient:function(){return a}}};